
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://tbd.com/reference/api/">
      
      
        <link rel="prev" href="../../troubleshooting/">
      
      
        <link rel="next" href="../facilitator/facilitator_bot/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.9">
    
    
      
        <title>api - HCI-FACE</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="light-blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#backend.app.api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="HCI-FACE" class="md-header__button md-logo" aria-label="HCI-FACE" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HCI-FACE
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              api
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/chrismbirmingham/hci-face" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Overview
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../frontend/" class="md-tabs__link">
      Frontend
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../backend/" class="md-tabs__link">
      Backend
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../modules/" class="md-tabs__link">
        Modules
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../tutorials/" class="md-tabs__link">
        Tutorials
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../troubleshooting/" class="md-tabs__link">
      Troubleshooting
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="./" class="md-tabs__link md-tabs__link--active">
        Backend Reference
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="HCI-FACE" class="md-nav__button md-logo" aria-label="HCI-FACE" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    HCI-FACE
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/chrismbirmingham/hci-face" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/" class="md-nav__link">
        Frontend
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../backend/" class="md-nav__link">
        Backend
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../modules/">Modules</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/chatbot/" class="md-nav__link">
        Chatbot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/facilitator/" class="md-nav__link">
        Facilitator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/recording/" class="md-nav__link">
        Recording
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/stt/" class="md-nav__link">
        Stt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/tts/" class="md-nav__link">
        Tts
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../tutorials/">Tutorials</a>
          
            <label for="__nav_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
          Advanced
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_4">
          <span class="md-nav__icon md-icon"></span>
          Advanced
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/advanced/adding_features/" class="md-nav__link">
        Adding New Features
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/advanced/choosing_your_backends/" class="md-nav__link">
        Choosing Your Backend
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/advanced/customizing_face/" class="md-nav__link">
        Customizing the Face
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Backend Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Backend Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          api
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        api
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#backend.app.api" class="md-nav__link">
    backend.app.api
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.add_to_face" class="md-nav__link">
    add_to_face()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.add_to_gesture" class="md-nav__link">
    add_to_gesture()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.get_response" class="md-nav__link">
    get_response()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.get_speech" class="md-nav__link">
    get_speech()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.return_gesture" class="md-nav__link">
    return_gesture()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.run_generate_response" class="md-nav__link">
    run_generate_response()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.run_transcribe_audio" class="md-nav__link">
    run_transcribe_audio()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.stream_face" class="md-nav__link">
    stream_face()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.stream_text" class="md-nav__link">
    stream_text()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.stream_viseme" class="md-nav__link">
    stream_viseme()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
          facilitator
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          facilitator
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../facilitator/facilitator_bot/" class="md-nav__link">
        facilitator_bot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../facilitator/facilitator_logic/" class="md-nav__link">
        facilitator_logic
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
          utils
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3">
          <span class="md-nav__icon md-icon"></span>
          utils
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3_1" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3_1" id="__nav_7_3_1_label" tabindex="0">
          chatbot
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3_1">
          <span class="md-nav__icon md-icon"></span>
          chatbot
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3_1_1" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3_1_1" id="__nav_7_3_1_1_label" tabindex="0">
          backends
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_3_1_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3_1_1">
          <span class="md-nav__icon md-icon"></span>
          backends
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/chatbot/backends/chatgpt/" class="md-nav__link">
        chatgpt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/chatbot/backends/zero_shot/" class="md-nav__link">
        zero_shot
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/chatbot/responder/" class="md-nav__link">
        responder
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3_2" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3_2" id="__nav_7_3_2_label" tabindex="0">
          recording
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3_2">
          <span class="md-nav__icon md-icon"></span>
          recording
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/recording/logger/" class="md-nav__link">
        logger
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3_3" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3_3" id="__nav_7_3_3_label" tabindex="0">
          stt
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3_3">
          <span class="md-nav__icon md-icon"></span>
          stt
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3_3_1" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3_3_1" id="__nav_7_3_3_1_label" tabindex="0">
          backends
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_3_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3_3_1">
          <span class="md-nav__icon md-icon"></span>
          backends
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/stt/backends/pyannote_diarization/" class="md-nav__link">
        pyannote_diarization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/stt/backends/record_mic/" class="md-nav__link">
        record_mic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/stt/backends/whisper_stt/" class="md-nav__link">
        whisper_stt
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/stt/transcriber/" class="md-nav__link">
        transcriber
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3_4" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3_4" id="__nav_7_3_4_label" tabindex="0">
          tts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_3_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3_4">
          <span class="md-nav__icon md-icon"></span>
          tts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3_4_1" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3_4_1" id="__nav_7_3_4_1_label" tabindex="0">
          backends
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_3_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3_4_1">
          <span class="md-nav__icon md-icon"></span>
          backends
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/tts/backends/aws_polly_tts/" class="md-nav__link">
        aws_polly_tts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/tts/backends/coqui_tts/" class="md-nav__link">
        coqui_tts
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3_4_1_3" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3_4_1_3" id="__nav_7_3_4_1_3_label" tabindex="0">
          resources
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_7_3_4_1_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3_4_1_3">
          <span class="md-nav__icon md-icon"></span>
          resources
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3_4_1_3_1" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3_4_1_3_1" id="__nav_7_3_4_1_3_1_label" tabindex="0">
          aws_example_code
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_7_3_4_1_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3_4_1_3_1">
          <span class="md-nav__icon md-icon"></span>
          aws_example_code
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/tts/backends/resources/aws_example_code/polly_lipsync/" class="md-nav__link">
        polly_lipsync
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/tts/backends/resources/aws_example_code/polly_wrapper/" class="md-nav__link">
        polly_wrapper
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/tts/backends/viseme_generator/" class="md-nav__link">
        viseme_generator
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/tts/speaker/" class="md-nav__link">
        speaker
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#backend.app.api" class="md-nav__link">
    backend.app.api
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.add_to_face" class="md-nav__link">
    add_to_face()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.add_to_gesture" class="md-nav__link">
    add_to_gesture()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.get_response" class="md-nav__link">
    get_response()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.get_speech" class="md-nav__link">
    get_speech()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.return_gesture" class="md-nav__link">
    return_gesture()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.run_generate_response" class="md-nav__link">
    run_generate_response()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.run_transcribe_audio" class="md-nav__link">
    run_transcribe_audio()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.stream_face" class="md-nav__link">
    stream_face()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.stream_text" class="md-nav__link">
    stream_text()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.api.stream_viseme" class="md-nav__link">
    stream_viseme()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



  <h1>api</h1>

<div class="doc doc-object doc-module">


<a id="backend.app.api"></a>
  <div class="doc doc-contents first">
  
      <p>Exposes interactive bot functionality through FastAPI</p>
<p>The backend consists of modules that expose the functionality needed
for a interactive multi-modal chatbot. This module provides an api to
that functionality that can be served to any frontend application.</p>
<p>The api provides methods for various forms of synchronous and asynchronous
communication</p>

<details class="synchronous-vs-asynchronous">
  <summary>Synchronous vs Asynchronous</summary>
  <ul>
<li>
<p>Functions that start with 'get' are synchronous.</p>
</li>
<li>
<p>Functions that start with 'run' are asynchronous, and the result are
returned through functions that start with 'stream'.</p>
</li>
<li>
<p>Functions that start with 'add_to' are semi-synchronous in that they synchronously
add to a queue which will be asynchronously processed by the face/bot.</p>
</li>
</ul>
</details>      <p>The api also allows communication between two different clients, such as how
the WoZ interface can send a gesture to the api, and the api will essentially
forward that gesture to the robot.</p>

<details class="example">
  <summary>Typical usage</summary>
  <p>As documented in https://fastapi.tiangolo.com/deployment/manually/
The api can be run from another module:
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;app.api:app&quot;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">reload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
</code></pre></div>
or it can be run directly:
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>uvicorn<span class="w"> </span>api:app<span class="w"> </span>--host<span class="w"> </span><span class="m">0</span>.0.0.0<span class="w"> </span>--port<span class="w"> </span><span class="m">80</span>
</code></pre></div></p>
</details>
  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="backend.app.api.add_to_face" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_to_face</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">update_type</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Sends desired expression, behavior, or viseme to the face</p>
<p>Face presets are sent from the WoZ to this API, and are then
loaded to the queue for the face to read.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>what command to send</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>update_type</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>what type of update to send, either expression
behavior, or viseme.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>PlainTextResponse</code></td>          <td>
                <code><span title="fastapi.responses.PlainTextResponse">PlainTextResponse</span></code>
          </td>
          <td><p>returns the requested text.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>backend/app/api.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/face_presets&quot;</span><span class="p">)</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="k">def</span> <span class="nf">add_to_face</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">update_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlainTextResponse</span><span class="p">:</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Sends desired expression, behavior, or viseme to the face</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">        Face presets are sent from the WoZ to this API, and are then</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">        loaded to the queue for the face to read.</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">            text (str): what command to send</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">            update_type (str): what type of update to send, either expression</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">                behavior, or viseme.</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">            PlainTextResponse: returns the requested text.&quot;&quot;&quot;</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>    <span class="n">l</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/api/face_presets: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">update_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>    <span class="k">if</span> <span class="n">update_type</span> <span class="o">==</span> <span class="s2">&quot;expression&quot;</span><span class="p">:</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="n">FACE_CONTROL_QUEUE</span><span class="p">[</span><span class="s2">&quot;expression&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>    <span class="k">if</span> <span class="n">update_type</span> <span class="o">==</span> <span class="s2">&quot;behavior&quot;</span><span class="p">:</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="n">FACE_CONTROL_QUEUE</span><span class="p">[</span><span class="s2">&quot;behavior&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>    <span class="k">if</span> <span class="n">update_type</span> <span class="o">==</span> <span class="s2">&quot;viseme&quot;</span><span class="p">:</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="n">FACE_CONTROL_QUEUE</span><span class="p">[</span><span class="s2">&quot;viseme&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>    <span class="k">return</span> <span class="n">PlainTextResponse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="backend.app.api.add_to_gesture" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_to_gesture</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add desired gesture to queue for the robot</p>
<p>This function provides a passthrough from the WoZ to the robot bridge.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Name of the gesture</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>PlainTextResponse</code></td>          <td>
                <code><span title="fastapi.responses.PlainTextResponse">PlainTextResponse</span></code>
          </td>
          <td><p>Returns the specified gesture.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>backend/app/api.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/qt_gesture&quot;</span><span class="p">)</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="k">def</span> <span class="nf">add_to_gesture</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlainTextResponse</span><span class="p">:</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add desired gesture to queue for the robot</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">        This function provides a passthrough from the WoZ to the robot bridge.</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">            text (str): Name of the gesture</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">            PlainTextResponse: Returns the specified gesture.&quot;&quot;&quot;</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="n">l</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/api/qt_gestures: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>    <span class="n">GESTURE_QUEUE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>    <span class="k">return</span> <span class="n">PlainTextResponse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="backend.app.api.get_response" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_response</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Returns text presets based on WoZ input</p>
<p>Mostly useful for controlling the robot during study interactions.
Does not use the text_stream as reponse is usually directly output.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>mode</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>What mode the facilitator is in. Possibilities include
role_model - for when the robot is leading a session as a role model,
direcctor - for when the robot is leading a session as a director,
and facilitator - for when the robot is not in either condition yet.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>query</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Key for looking up matching text response.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>PlainTextResponse</code></td>          <td>
                <code><span title="fastapi.responses.PlainTextResponse">PlainTextResponse</span></code>
          </td>
          <td><p>Text for the faciliatator to say.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>backend/app/api.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/facilitator_presets&quot;</span><span class="p">)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="k">def</span> <span class="nf">get_response</span><span class="p">(</span><span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlainTextResponse</span><span class="p">:</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns text presets based on WoZ input</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">        Mostly useful for controlling the robot during study interactions.</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">        Does not use the text_stream as reponse is usually directly output.</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">            mode (str): What mode the facilitator is in. Possibilities include</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">                role_model - for when the robot is leading a session as a role model,</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">                direcctor - for when the robot is leading a session as a director,</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">                and facilitator - for when the robot is not in either condition yet.</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">            query (str): Key for looking up matching text response.</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">            PlainTextResponse: Text for the faciliatator to say.&quot;&quot;&quot;</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="n">l</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/api/facilitator_presets: </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;facilitator&quot;</span><span class="p">:</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="n">to_say</span> <span class="o">=</span> <span class="n">presets</span><span class="o">.</span><span class="n">responses</span><span class="p">[</span><span class="n">query</span><span class="p">]</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;director&quot;</span><span class="p">:</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="k">if</span> <span class="n">query</span> <span class="o">==</span> <span class="s2">&quot;disclosure&quot;</span><span class="p">:</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>            <span class="n">to_say</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">disclosure_elicitation</span><span class="p">)</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="k">if</span> <span class="n">query</span> <span class="o">==</span> <span class="s2">&quot;response&quot;</span><span class="p">:</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>            <span class="n">to_say</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">response_elicitation</span><span class="p">)</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;role_model&quot;</span><span class="p">:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="k">if</span> <span class="n">query</span> <span class="o">==</span> <span class="s2">&quot;disclosure&quot;</span><span class="p">:</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="n">emotion</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rmf</span><span class="o">.</span><span class="n">disclosures</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="n">transition</span> <span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">rmf</span><span class="o">.</span><span class="n">transition_to_disclosure</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[EMOTION]&quot;</span><span class="p">,</span> <span class="n">emotion</span><span class="p">)</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>            <span class="n">disclosure</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">rmf</span><span class="o">.</span><span class="n">disclosures</span><span class="p">[</span><span class="n">emotion</span><span class="p">])</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>            <span class="n">re_transition</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">rmf</span><span class="o">.</span><span class="n">transition_back_to_group</span><span class="p">)</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="n">responses</span> <span class="o">=</span> <span class="p">[</span><span class="n">transition</span><span class="p">,</span> <span class="n">disclosure</span><span class="p">,</span> <span class="n">re_transition</span><span class="p">]</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="n">to_say</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="k">if</span> <span class="n">query</span> <span class="o">==</span> <span class="s2">&quot;response&quot;</span><span class="p">:</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;getting response&quot;</span><span class="p">)</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>            <span class="n">to_say</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">rmf</span><span class="o">.</span><span class="n">disclosure_responses</span><span class="p">[</span><span class="s2">&quot;sympathy expressions&quot;</span><span class="p">][</span><span class="s2">&quot;neutral&quot;</span><span class="p">])</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">to_say</span><span class="p">)</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>            <span class="n">to_say2</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">rmf</span><span class="o">.</span><span class="n">disclosure_responses</span><span class="p">[</span><span class="s2">&quot;clarification requests&quot;</span><span class="p">])</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">to_say</span><span class="p">,</span><span class="n">to_say2</span><span class="p">)</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>            <span class="n">to_say</span> <span class="o">=</span> <span class="n">to_say</span> <span class="o">+</span> <span class="s2">&quot;. &quot;</span> <span class="o">+</span> <span class="n">to_say2</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>    <span class="n">l</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;facilitator_presets response: </span><span class="si">{</span><span class="n">to_say</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="k">return</span> <span class="n">PlainTextResponse</span><span class="p">(</span><span class="n">to_say</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="backend.app.api.get_speech" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_speech</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">speaker_id</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Synthesizes wav bytes from text, with a given speaker ID</p>
<p>This text will be spoken immediately after it is generated, so the
bot is updated with the knowledge that the facilitator is actually
saying this text.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Text to e synthesized</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>speaker_id</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>ID of the voice to be used. Defaults to "".</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>StreamingResponse</code></td>          <td>
                <code><span title="fastapi.responses.StreamingResponse">StreamingResponse</span></code>
          </td>
          <td><p>Audio stream of the voice saying the text.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>backend/app/api.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/speech&quot;</span><span class="p">)</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="k">def</span> <span class="nf">get_speech</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">speaker_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StreamingResponse</span><span class="p">:</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Synthesizes wav bytes from text, with a given speaker ID</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">        This text will be spoken immediately after it is generated, so the</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">        bot is updated with the knowledge that the facilitator is actually</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">        saying this text.</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="sd">            text (str): Text to e synthesized</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">            speaker_id (str, optional): ID of the voice to be used. Defaults to &quot;&quot;.</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">            StreamingResponse: Audio stream of the voice saying the text.&quot;&quot;&quot;</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="n">l</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/api/speech: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">speaker_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="n">bot</span><span class="o">.</span><span class="n">chatbot</span><span class="o">.</span><span class="n">accept_response</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="k">global</span> <span class="n">FACE_CONTROL_QUEUE</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="k">global</span> <span class="n">VISEME_DELAYS</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="n">dt_string</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">get_date_str</span><span class="p">()</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>    <span class="n">audio_stream</span><span class="p">,</span> <span class="n">visemes</span><span class="p">,</span> <span class="n">delays</span> <span class="o">=</span> <span class="n">tts</span><span class="o">.</span><span class="n">synthesize</span><span class="p">(</span><span class="n">text</span><span class="p">,</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>                                                   <span class="n">speaker_id</span><span class="p">,</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>                                                   <span class="n">save_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">LOGS_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">dt_string</span><span class="si">}</span><span class="s2">.wav&quot;</span><span class="p">)</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>    <span class="n">VISEME_DELAYS</span> <span class="o">+=</span> <span class="n">delays</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="n">FACE_CONTROL_QUEUE</span><span class="p">[</span><span class="s2">&quot;viseme&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">visemes</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="k">return</span> <span class="n">StreamingResponse</span><span class="p">(</span><span class="n">audio_stream</span><span class="p">,</span> <span class="n">media_type</span><span class="o">=</span><span class="s2">&quot;audio/wav&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="backend.app.api.return_gesture" class="doc doc-heading">
<code class="highlight language-python"><span class="n">return_gesture</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get next gesture from the queue.</p>
<p>This exposes an endpoint for the robot to regularly ping
in order to fetch the next gesture it should do.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>PlainTextResponse</code></td>          <td>
                <code><span title="fastapi.responses.PlainTextResponse">PlainTextResponse</span></code>
          </td>
          <td><p>desired gesture.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>backend/app/api.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/next_gesture&quot;</span><span class="p">)</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="k">def</span> <span class="nf">return_gesture</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">PlainTextResponse</span><span class="p">:</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get next gesture from the queue.</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="sd">        This exposes an endpoint for the robot to regularly ping</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">        in order to fetch the next gesture it should do.</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">            PlainTextResponse: desired gesture.&quot;&quot;&quot;</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>    <span class="k">global</span> <span class="n">GESTURE_QUEUE</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">GESTURE_QUEUE</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>        <span class="n">gesture</span> <span class="o">=</span> <span class="n">GESTURE_QUEUE</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>        <span class="n">l</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/api/next_gesture: </span><span class="si">{</span><span class="n">gesture</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>    <span class="k">else</span><span class="p">:</span> <span class="n">gesture</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>    <span class="c1"># l.log(f&quot;/api/next_gesture: {gesture}&quot;)</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>    <span class="k">return</span> <span class="n">PlainTextResponse</span><span class="p">(</span><span class="n">gesture</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="backend.app.api.run_generate_response" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_generate_response</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">speaker</span><span class="p">,</span> <span class="n">reset_conversation</span><span class="p">,</span> <span class="n">director_condition</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Takes input text and generates possible bot responses</p>
<p>Possible bot responses include generative responses from the chatbot
as well as controlled responses from the facilitator. The classifications
used for generating the facilitator response are added as well.
Additionally, the emotion that was found in the text is mirrored by
the robots expression if it is in the subset of possible expressions (joy
sad, surprise)</p>

<details class="warning">
  <summary>warning</summary>
  <p>All of this text is returned asynchronously through the text_stream.
The default response is set to the bot response.</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Input said by a human.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>speaker</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Identify of the speaker</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>reset_conversation</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether or not to restart the conversation.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>director_condition</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Flag for controlling what type of
facilitator is used.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>PlainTextResponse</code></td>          <td>
                <code><span title="fastapi.responses.PlainTextResponse">PlainTextResponse</span></code>
          </td>
          <td><p>Defaults to generative bot response.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>backend/app/api.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/bot_response&quot;</span><span class="p">)</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="k">def</span> <span class="nf">run_generate_response</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">speaker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                      <span class="n">reset_conversation</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                      <span class="n">director_condition</span><span class="p">:</span> <span class="nb">bool</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlainTextResponse</span><span class="p">:</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Takes input text and generates possible bot responses</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">        Possible bot responses include generative responses from the chatbot</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">        as well as controlled responses from the facilitator. The classifications</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">        used for generating the facilitator response are added as well.</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">        Additionally, the emotion that was found in the text is mirrored by</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">        the robots expression if it is in the subset of possible expressions (joy</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        sad, surprise)</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">        warning:</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">            All of this text is returned asynchronously through the text_stream.</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">            The default response is set to the bot response.</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">            text (str): Input said by a human.</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">            speaker (str): Identify of the speaker</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">            reset_conversation (bool): Whether or not to restart the conversation.</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">            director_condition (bool): Flag for controlling what type of</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">                facilitator is used.</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">            PlainTextResponse: Defaults to generative bot response.&quot;&quot;&quot;</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="n">l</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/api/bot_response: &#39;</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&#39;, from </span><span class="si">{</span><span class="n">speaker</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>          <span class="sa">f</span><span class="s2">&quot;reset_conversation: </span><span class="si">{</span><span class="n">reset_conversation</span><span class="si">}</span><span class="s2">, director_condition: </span><span class="si">{</span><span class="n">director_condition</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>    <span class="k">global</span> <span class="n">TEXT_QUEUE</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>    <span class="n">classifications</span> <span class="o">=</span> <span class="n">bot</span><span class="o">.</span><span class="n">get_classifications</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="n">TEXT_QUEUE</span><span class="p">[</span><span class="s2">&quot;classifications&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">classifications</span><span class="p">)</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>    <span class="k">if</span> <span class="n">bot</span><span class="o">.</span><span class="n">classification_processor</span><span class="o">.</span><span class="n">emotion</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;joy&quot;</span><span class="p">,</span> <span class="s2">&quot;sad&quot;</span><span class="p">,</span> <span class="s2">&quot;surprise&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="n">l</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting face to: </span><span class="si">{</span><span class="n">bot</span><span class="o">.</span><span class="n">classification_processor</span><span class="o">.</span><span class="n">emotion</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="n">FACE_CONTROL_QUEUE</span><span class="p">[</span><span class="s2">&quot;expression&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bot</span><span class="o">.</span><span class="n">classification_processor</span><span class="o">.</span><span class="n">emotion</span><span class="p">)</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="n">l</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Setting face to: neutral&quot;</span><span class="p">)</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="n">FACE_CONTROL_QUEUE</span><span class="p">[</span><span class="s2">&quot;expression&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;neutral&quot;</span><span class="p">)</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>    <span class="n">facilitator_response</span> <span class="o">=</span> <span class="n">bot</span><span class="o">.</span><span class="n">get_facilitator_response</span><span class="p">(</span><span class="n">director_condition</span><span class="p">)</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>    <span class="n">TEXT_QUEUE</span><span class="p">[</span><span class="s2">&quot;facilitator_response&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">facilitator_response</span><span class="p">)</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>    <span class="n">bot_response</span><span class="o">=</span> <span class="n">bot</span><span class="o">.</span><span class="n">get_bot_response</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">speaker</span><span class="p">,</span> <span class="n">reset_conversation</span><span class="p">)</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>    <span class="n">TEXT_QUEUE</span><span class="p">[</span><span class="s2">&quot;bot_response&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bot_response</span><span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span class="n">bot</span><span class="o">.</span><span class="n">chatbot</span><span class="o">.</span><span class="n">reject_response</span><span class="p">()</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="k">return</span> <span class="n">PlainTextResponse</span><span class="p">(</span><span class="n">bot_response</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="backend.app.api.run_transcribe_audio" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_transcribe_audio</span><span class="p">(</span><span class="n">uploaded_file</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Perform speech to text on audio file</p>
<p>transcribes audio from file and adds transcribed text to
human_speech in the text queue.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>uploaded_file</code></td>
          <td>
                <code><span title="fastapi.UploadFile">UploadFile</span></code>
          </td>
          <td><p>Recorded audio.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>name of the saved audio file.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>backend/app/api.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/api/audio&quot;</span><span class="p">)</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">run_transcribe_audio</span><span class="p">(</span><span class="n">uploaded_file</span><span class="p">:</span> <span class="n">UploadFile</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform speech to text on audio file</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">        transcribes audio from file and adds transcribed text to</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">        human_speech in the text queue.</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">            uploaded_file (UploadFile): Recorded audio.</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">            dict: name of the saved audio file.&quot;&quot;&quot;</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>    <span class="n">l</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;/api/audio: temp.wav&quot;</span><span class="p">)</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>    <span class="n">contents</span> <span class="o">=</span> <span class="n">uploaded_file</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>    <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>    <span class="n">audio_clip</span> <span class="o">=</span> <span class="n">AudioSegment</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">data_bytes</span><span class="p">,</span> <span class="n">codec</span><span class="o">=</span><span class="s1">&#39;opus&#39;</span><span class="p">)</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>    <span class="n">l</span><span class="o">.</span><span class="n">log_sound</span><span class="p">(</span><span class="n">audio_clip</span><span class="p">)</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>    <span class="n">transcription</span> <span class="o">=</span> <span class="n">stt</span><span class="o">.</span><span class="n">transcribe_clip</span><span class="p">(</span><span class="n">audio_clip</span><span class="p">)</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">transcription</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="k">global</span> <span class="n">TEXT_QUEUE</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>        <span class="n">TEXT_QUEUE</span><span class="p">[</span><span class="s2">&quot;human_speech&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transcription</span><span class="p">)</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="n">l</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Speech Detected: </span><span class="si">{</span><span class="n">transcription</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;temp.wav&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="backend.app.api.stream_face" class="doc doc-heading">
<code class="highlight language-python"><span class="n">stream_face</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Publishes face control messages to a subscriber</p>
<p>Publishes messages as soon as they are added to the queue.
Message event argument specifies the type of face control
message being sent, expression or behavior</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>request</code></td>
          <td>
                <code><span title="fastapi.Request">Request</span></code>
          </td>
          <td><p>Request for event generator when
    API is called.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>EventSourceResponse</code></td>          <td>
                <code><span title="sse_starlette.sse.EventSourceResponse">EventSourceResponse</span></code>
          </td>
          <td><p>Server Sent Event (sse) source.</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Yields:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="sse_starlette.sse.EventSourceResponse">EventSourceResponse</span></code>
          </td>
          <td><p>Iterator[EventSourceResponse]: Strings for a face behavior or
expression</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>backend/app/api.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/api/face_stream&#39;</span><span class="p">)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">stream_face</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EventSourceResponse</span><span class="p">:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Publishes face control messages to a subscriber</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        Publishes messages as soon as they are added to the queue.</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">        Message event argument specifies the type of face control</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">        message being sent, expression or behavior</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">            request (Request): Request for event generator when</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">                    API is called.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">            EventSourceResponse: Server Sent Event (sse) source.</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">            Iterator[EventSourceResponse]: Strings for a face behavior or</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">                expression&quot;&quot;&quot;</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="c1"># l.log(&quot;/api/face_stream: request recieved.&quot;)</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">event_generator</span><span class="p">():</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>            <span class="c1"># If client closes connection, stop sending events</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="k">if</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">is_disconnected</span><span class="p">():</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>                <span class="c1"># print(&quot;Disconnected&quot;)</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>                <span class="k">break</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="k">global</span> <span class="n">FACE_CONTROL_QUEUE</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>            <span class="c1"># Checks for new messages and return them to client if any</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">msg_queue</span> <span class="ow">in</span> <span class="n">FACE_CONTROL_QUEUE</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;viseme&#39;</span><span class="p">:</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg_queue</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">msg_queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>                    <span class="n">l</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;face control message: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                    <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                            <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;message_id&quot;</span><span class="p">,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>                            <span class="s2">&quot;retry&quot;</span><span class="p">:</span> <span class="n">RETRY_TIMEOUT</span><span class="p">,</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                    <span class="p">}</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>                    <span class="k">yield</span> <span class="n">response</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">.03</span><span class="p">)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="k">return</span> <span class="n">EventSourceResponse</span><span class="p">(</span><span class="n">event_generator</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="backend.app.api.stream_text" class="doc doc-heading">
<code class="highlight language-python"><span class="n">stream_text</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Publishes text messages to a subscriber</p>
<p>Publishes messages as soon as they are added to the queue.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>request</code></td>
          <td>
                <code><span title="fastapi.Request">Request</span></code>
          </td>
          <td><p>Request for event generator when
    API is called.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>EventSourceResponse</code></td>          <td>
          </td>
          <td><p>Server Sent Event (sse) source.</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Yields:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td><p>Iterator[EventSourceResponse]: Strings of text</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>backend/app/api.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/api/text_stream&#39;</span><span class="p">)</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">stream_text</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Publishes text messages to a subscriber</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">        Publishes messages as soon as they are added to the queue.</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">            request (Request): Request for event generator when</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">                    API is called.</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">            EventSourceResponse: Server Sent Event (sse) source.</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">            Iterator[EventSourceResponse]: Strings of text&quot;&quot;&quot;</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="n">l</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;/api/text: request recieved.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">event_generator</span><span class="p">():</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="c1"># If client closes connection, stop sending events</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="k">if</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">is_disconnected</span><span class="p">():</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>                <span class="c1"># print(&quot;Disconnected&quot;)</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>                <span class="k">break</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="k">global</span> <span class="n">TEXT_QUEUE</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="c1"># Checks for new messages and return them to client if any</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">msg_queue</span> <span class="ow">in</span> <span class="n">TEXT_QUEUE</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg_queue</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">msg_queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>                    <span class="n">l</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Text message: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>                    <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                            <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>                            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;message_id&quot;</span><span class="p">,</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                            <span class="s2">&quot;retry&quot;</span><span class="p">:</span> <span class="n">RETRY_TIMEOUT</span><span class="p">,</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>                            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>                    <span class="p">}</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                    <span class="k">yield</span> <span class="n">response</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">.03</span><span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="k">return</span> <span class="n">EventSourceResponse</span><span class="p">(</span><span class="n">event_generator</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="backend.app.api.stream_viseme" class="doc doc-heading">
<code class="highlight language-python"><span class="n">stream_viseme</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Publishes visemes to a subscriber</p>
<p>Publishes the viseme after the corresponding viseme delay.
Only publishes when there are visemes in the queue.
If no subscribers are listening it will not send any messages
and the queue will continue to grow.</p>

<details class="warning">
  <summary>warning</summary>
  <p>Only publishes each viseme once. If you have multiple subscribers
(e.g. multiple tabs or multiple devices with the face open) each
of the subscribers will only recieve a subset of the visemes.</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>request</code></td>
          <td>
                <code><span title="fastapi.Request">Request</span></code>
          </td>
          <td><p>Request for event generator when
API is called.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>EventSourceResponse</code></td>          <td>
          </td>
          <td><p>Server Sent Event (sse) source.</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Yields:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td><p>Iterator[EventSourceResponse]: Strings for a viseme
(the desired shape of the mouth)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>backend/app/api.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/api/viseme_stream&#39;</span><span class="p">)</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">stream_viseme</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Publishes visemes to a subscriber</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        Publishes the viseme after the corresponding viseme delay.</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        Only publishes when there are visemes in the queue.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        If no subscribers are listening it will not send any messages</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        and the queue will continue to grow.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        warning:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">            Only publishes each viseme once. If you have multiple subscribers</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">            (e.g. multiple tabs or multiple devices with the face open) each</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">            of the subscribers will only recieve a subset of the visemes.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">            request (Request): Request for event generator when</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">                API is called.</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">            EventSourceResponse: Server Sent Event (sse) source.</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">            Iterator[EventSourceResponse]: Strings for a viseme</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">                (the desired shape of the mouth)&quot;&quot;&quot;</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="n">l</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;/api/visemes: request recieved.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">event_generator</span><span class="p">():</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="k">global</span> <span class="n">VISEME_DELAYS</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="c1"># If client closes connection, stop sending events</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="k">if</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">is_disconnected</span><span class="p">():</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                <span class="c1"># print(&quot;Disconnected&quot;)</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                <span class="k">break</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="k">global</span> <span class="n">FACE_CONTROL_QUEUE</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="c1"># Checks for new messages and return them to client if any</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">FACE_CONTROL_QUEUE</span><span class="p">[</span><span class="s2">&quot;viseme&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>                <span class="n">msg</span> <span class="o">=</span> <span class="n">FACE_CONTROL_QUEUE</span><span class="p">[</span><span class="s2">&quot;viseme&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>                <span class="c1"># l.log(f&quot;Viseme msg: {msg}&quot;, printnow=True)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                        <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;viseme&quot;</span><span class="p">,</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;message_id&quot;</span><span class="p">,</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                        <span class="s2">&quot;retry&quot;</span><span class="p">:</span> <span class="n">RETRY_TIMEOUT</span><span class="p">,</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                <span class="p">}</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="k">yield</span> <span class="n">response</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">VISEME_DELAYS</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                <span class="n">sleep_delay</span> <span class="o">=</span> <span class="n">VISEME_DELAYS</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                <span class="c1"># l.log(f&quot;Sleep Delay: {sleep_delay}&quot;, printnow=True)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_delay</span><span class="p">)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="k">else</span><span class="p">:</span><span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">.05</span><span class="p">)</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="k">return</span> <span class="n">EventSourceResponse</span><span class="p">(</span><span class="n">event_generator</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.sections", "navigation.tracking", "navigation.expand"], "search": "../../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.a00a7c5e.min.js"></script>
      
    
  </body>
</html>