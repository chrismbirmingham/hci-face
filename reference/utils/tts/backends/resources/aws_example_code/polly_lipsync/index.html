
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://tbd.com/reference/utils/tts/backends/resources/aws_example_code/polly_lipsync/">
      
      
        <link rel="prev" href="../../../coqui_tts/">
      
      
        <link rel="next" href="../polly_wrapper/">
      
      <link rel="icon" href="../../../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.9">
    
    
      
        <title>polly_lipsync - HCI-FACE</title>
      
    
    
      <link rel="stylesheet" href="../../../../../../../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../../../../../../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="light-blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../../../.." title="HCI-FACE" class="md-header__button md-logo" aria-label="HCI-FACE" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HCI-FACE
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              polly_lipsync
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/chrismbirmingham/hci-face" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../../../.." class="md-tabs__link">
      Overview
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../../../../frontend/" class="md-tabs__link">
      Frontend
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../../../../backend/" class="md-tabs__link">
      Backend
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../../modules/" class="md-tabs__link">
        Modules
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../../tutorials/" class="md-tabs__link">
        Tutorials
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../../../../troubleshooting/" class="md-tabs__link">
      Troubleshooting
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../api/" class="md-tabs__link md-tabs__link--active">
        Backend Reference
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../../../.." title="HCI-FACE" class="md-nav__button md-logo" aria-label="HCI-FACE" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    HCI-FACE
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/chrismbirmingham/hci-face" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../.." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../../frontend/" class="md-nav__link">
        Frontend
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../../backend/" class="md-nav__link">
        Backend
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../../../../modules/">Modules</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../../modules/chatbot/" class="md-nav__link">
        Chatbot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../../modules/facilitator/" class="md-nav__link">
        Facilitator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../../modules/recording/" class="md-nav__link">
        Recording
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../../modules/stt/" class="md-nav__link">
        Stt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../../modules/tts/" class="md-nav__link">
        Tts
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../../../../tutorials/">Tutorials</a>
          
            <label for="__nav_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../../tutorials/getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../../tutorials/installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
          Advanced
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_4">
          <span class="md-nav__icon md-icon"></span>
          Advanced
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../../tutorials/advanced/adding_features/" class="md-nav__link">
        Adding New Features
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../../tutorials/advanced/choosing_your_backends/" class="md-nav__link">
        Choosing Your Backend
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../../tutorials/advanced/customizing_face/" class="md-nav__link">
        Customizing the Face
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../../troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Backend Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Backend Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../api/" class="md-nav__link">
        api
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
          facilitator
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          facilitator
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../facilitator/facilitator_bot/" class="md-nav__link">
        facilitator_bot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../facilitator/facilitator_logic/" class="md-nav__link">
        facilitator_logic
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" checked>
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
          utils
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_7_3">
          <span class="md-nav__icon md-icon"></span>
          utils
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3_1" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3_1" id="__nav_7_3_1_label" tabindex="0">
          chatbot
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3_1">
          <span class="md-nav__icon md-icon"></span>
          chatbot
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3_1_1" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3_1_1" id="__nav_7_3_1_1_label" tabindex="0">
          backends
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_3_1_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3_1_1">
          <span class="md-nav__icon md-icon"></span>
          backends
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../chatbot/backends/chatgpt/" class="md-nav__link">
        chatgpt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../chatbot/backends/zero_shot/" class="md-nav__link">
        zero_shot
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../chatbot/responder/" class="md-nav__link">
        responder
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3_2" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3_2" id="__nav_7_3_2_label" tabindex="0">
          recording
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3_2">
          <span class="md-nav__icon md-icon"></span>
          recording
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../recording/logger/" class="md-nav__link">
        logger
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3_3" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3_3" id="__nav_7_3_3_label" tabindex="0">
          stt
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3_3">
          <span class="md-nav__icon md-icon"></span>
          stt
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3_3_1" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3_3_1" id="__nav_7_3_3_1_label" tabindex="0">
          backends
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_3_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3_3_1">
          <span class="md-nav__icon md-icon"></span>
          backends
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../stt/backends/pyannote_diarization/" class="md-nav__link">
        pyannote_diarization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../stt/backends/record_mic/" class="md-nav__link">
        record_mic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../stt/backends/whisper_stt/" class="md-nav__link">
        whisper_stt
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../stt/transcriber/" class="md-nav__link">
        transcriber
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3_4" checked>
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3_4" id="__nav_7_3_4_label" tabindex="0">
          tts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_3_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_7_3_4">
          <span class="md-nav__icon md-icon"></span>
          tts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3_4_1" checked>
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3_4_1" id="__nav_7_3_4_1_label" tabindex="0">
          backends
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_3_4_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_7_3_4_1">
          <span class="md-nav__icon md-icon"></span>
          backends
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../aws_polly_tts/" class="md-nav__link">
        aws_polly_tts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../coqui_tts/" class="md-nav__link">
        coqui_tts
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3_4_1_3" checked>
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3_4_1_3" id="__nav_7_3_4_1_3_label" tabindex="0">
          resources
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_7_3_4_1_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_7_3_4_1_3">
          <span class="md-nav__icon md-icon"></span>
          resources
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3_4_1_3_1" checked>
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3_4_1_3_1" id="__nav_7_3_4_1_3_1_label" tabindex="0">
          aws_example_code
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_7_3_4_1_3_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_7_3_4_1_3_1">
          <span class="md-nav__icon md-icon"></span>
          aws_example_code
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          polly_lipsync
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        polly_lipsync
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync" class="md-nav__link">
    backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth" class="md-nav__link">
    PollyMouth
  </a>
  
    <nav class="md-nav" aria-label="PollyMouth">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.animate_lips" class="md-nav__link">
    animate_lips()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.change_engine" class="md-nav__link">
    change_engine()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.change_language" class="md-nav__link">
    change_language()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.load_lips" class="md-nav__link">
    load_lips()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.long_text_wait_callback" class="md-nav__link">
    long_text_wait_callback()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.say_it" class="md-nav__link">
    say_it()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../polly_wrapper/" class="md-nav__link">
        polly_wrapper
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../viseme_generator/" class="md-nav__link">
        viseme_generator
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../speaker/" class="md-nav__link">
        speaker
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync" class="md-nav__link">
    backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth" class="md-nav__link">
    PollyMouth
  </a>
  
    <nav class="md-nav" aria-label="PollyMouth">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.animate_lips" class="md-nav__link">
    animate_lips()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.change_engine" class="md-nav__link">
    change_engine()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.change_language" class="md-nav__link">
    change_language()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.load_lips" class="md-nav__link">
    load_lips()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.long_text_wait_callback" class="md-nav__link">
    long_text_wait_callback()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.say_it" class="md-nav__link">
    say_it()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



  <h1>polly_lipsync</h1>

<div class="doc doc-object doc-module">


<a id="backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync"></a>
  <div class="doc doc-contents first">
  
      <p>Purpose</p>
<p>Shows how to use the AWS SDK for Python (Boto3) with Amazon Polly and Tkinter to
create a lip-sync application that displays an animated face speaking along with the
speech synthesized by Amazon Polly. Lip-sync is accomplished by requesting a list
of visemes from Amazon Polly that match up with the synthesized speech.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth" class="doc doc-heading">
        <code>PollyMouth</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>A Tkinter application that lets a user enter text, select an Amazon Polly voice,
and hear the text spoken by the selected voice while an animated face lip-syncs
along with it.</p>


        <details class="quote">
          <summary>Source code in <code>backend/app/utils/tts/backends/resources/aws_example_code/polly_lipsync.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="k">class</span> <span class="nc">PollyMouth</span><span class="p">:</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    A Tkinter application that lets a user enter text, select an Amazon Polly voice,</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    and hear the text spoken by the selected voice while an animated face lip-syncs</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    along with it.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="c1"># A dictionary of visemes mapped to image file names.</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="n">lips</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;.media/lips_m.png&#39;</span><span class="p">},</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;.media/lips_c.png&#39;</span><span class="p">},</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;.media/lips_ch.png&#39;</span><span class="p">},</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;.media/lips_th.png&#39;</span><span class="p">},</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;.media/lips_f.png&#39;</span><span class="p">},</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;.media/lips_c.png&#39;</span><span class="p">},</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="s1">&#39;i&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;.media/lips_e.png&#39;</span><span class="p">},</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;.media/lips_r.png&#39;</span><span class="p">},</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;.media/lips_c.png&#39;</span><span class="p">},</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="s1">&#39;u&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;.media/lips_w.png&#39;</span><span class="p">},</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="s1">&#39;@&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;.media/lips_u.png&#39;</span><span class="p">},</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;.media/lips_a.png&#39;</span><span class="p">},</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;.media/lips_a.png&#39;</span><span class="p">},</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;.media/lips_u.png&#39;</span><span class="p">},</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="s1">&#39;o&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;.media/lips_o.png&#39;</span><span class="p">},</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;.media/lips_u.png&#39;</span><span class="p">},</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="s1">&#39;sil&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;.media/lips_sil.png&#39;</span><span class="p">}</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="p">}</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polly_wrapper</span><span class="p">):</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        Initializes the main Tkinter window and adds all of the widgets needed for</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        the application.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        :param polly_wrapper: An object that can call Amazon Polly API functions.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">polly_wrapper</span> <span class="o">=</span> <span class="n">polly_wrapper</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Amazon Polly Lip Sync&quot;</span><span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">resizable</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_lips</span><span class="p">()</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="n">choices_frame</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sayit_label</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">wraplength</span><span class="o">=</span><span class="mi">410</span><span class="p">,</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Write some text in the box below, then click &#39;Say it!&#39; &quot;</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>                 <span class="s2">&quot;to hear and see your text.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sayit_txt</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">engine_label</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">choices_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Engine:&#39;</span><span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">engine_var</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">StringVar</span><span class="p">(</span><span class="n">choices_frame</span><span class="p">,</span> <span class="s1">&#39;neural&#39;</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">engine_options</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">OptionMenu</span><span class="p">(</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="n">choices_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine_var</span><span class="p">,</span> <span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="n">polly_wrapper</span><span class="o">.</span><span class="n">get_voice_engines</span><span class="p">()),</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">change_engine</span><span class="p">)</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_label</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">choices_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Language:&#39;</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_var</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">StringVar</span><span class="p">(</span><span class="n">choices_frame</span><span class="p">,</span> <span class="s1">&#39;US English&#39;</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_choices</span> <span class="o">=</span> <span class="n">polly_wrapper</span><span class="o">.</span><span class="n">get_languages</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine_var</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_options</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">OptionMenu</span><span class="p">(</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">choices_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_var</span><span class="p">,</span> <span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">language_choices</span><span class="p">),</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">change_language</span><span class="p">)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">voice_label</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">choices_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Voice:&#39;</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">voice_var</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">StringVar</span><span class="p">(</span><span class="n">choices_frame</span><span class="p">,</span> <span class="s1">&#39;Joanna&#39;</span><span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">voice_choices</span> <span class="o">=</span> <span class="n">polly_wrapper</span><span class="o">.</span><span class="n">get_voices</span><span class="p">(</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">engine_var</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_choices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">language_var</span><span class="o">.</span><span class="n">get</span><span class="p">()])</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">voice_options</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">OptionMenu</span><span class="p">(</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="n">choices_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">voice_var</span><span class="p">,</span> <span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">voice_choices</span><span class="p">))</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">face_canvas</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="n">choices_frame</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sayit_button</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Say it!&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">say_it</span><span class="p">)</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">loading_text</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s2">&quot;635x320&quot;</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sayit_label</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sayit_txt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sayit_txt</span><span class="o">.</span><span class="n">focus_set</span><span class="p">()</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sayit_button</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">columnspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sayit_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">85</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="n">choices_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tkinter</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">engine_label</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tkinter</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">engine_options</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tkinter</span><span class="o">.</span><span class="n">NW</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">engine_options</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_label</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tkinter</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_options</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tkinter</span><span class="o">.</span><span class="n">NW</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_options</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">voice_label</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tkinter</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">voice_options</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tkinter</span><span class="o">.</span><span class="n">NW</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">voice_options</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">face_canvas</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">columnspan</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">face_canvas</span><span class="o">.</span><span class="n">create_image</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lips</span><span class="p">[</span><span class="s1">&#39;sil&#39;</span><span class="p">][</span><span class="s1">&#39;image&#39;</span><span class="p">])</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">def</span> <span class="nf">load_lips</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        Loads lip-sync images either from a local &#39;.media&#39; folder or from GitHub</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        and saves image data in a dictionary of visemes.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s1">&#39;.media&#39;</span><span class="p">):</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Found .media folder. Loading images from the local folder.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="k">for</span> <span class="n">viseme</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lips</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lips</span><span class="p">[</span><span class="n">viseme</span><span class="p">][</span><span class="s1">&#39;image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                    <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lips</span><span class="p">[</span><span class="n">viseme</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No local .media folder. Trying to load images from GitHub.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="k">for</span> <span class="n">viseme</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lips</span><span class="p">:</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>                <span class="n">url</span> <span class="o">=</span> <span class="n">GITHUB_URL</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lips</span><span class="p">[</span><span class="n">viseme</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>                <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span> <span class="k">else</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>                <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t load image from </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lips</span><span class="p">[</span><span class="n">viseme</span><span class="p">][</span><span class="s1">&#39;image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">img</span><span class="p">)</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="k">def</span> <span class="nf">change_engine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">engine</span><span class="p">):</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        Handles the event that is fired when the selected engine type is changed in</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        the UI. Updates the lists of available languages and voices that are supported</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        for the selected engine type.</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        :param engine: The newly selected engine type.</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_choices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polly_wrapper</span><span class="o">.</span><span class="n">get_languages</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="n">lang_menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_options</span><span class="p">[</span><span class="s1">&#39;menu&#39;</span><span class="p">]</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="n">lang_menu</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="n">sorted_choices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">language_choices</span><span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">sorted_choices</span><span class="p">:</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>            <span class="n">lang_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>                <span class="n">label</span><span class="o">=</span><span class="n">lang</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="k">lambda</span> <span class="n">l</span><span class="o">=</span><span class="n">lang</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_language</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">change_language</span><span class="p">(</span><span class="n">sorted_choices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="k">def</span> <span class="nf">change_language</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">language</span><span class="p">):</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">        Handles the event that is fired when the selected language is changed in the</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">        UI. Updates the list of available voices that are available for the selected</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">        language and engine type.</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">        :param language: The newly selected language.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">language</span><span class="p">)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">voice_choices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polly_wrapper</span><span class="o">.</span><span class="n">get_voices</span><span class="p">(</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">engine_var</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_choices</span><span class="p">[</span><span class="n">language</span><span class="p">])</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="n">voice_menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">voice_options</span><span class="p">[</span><span class="s1">&#39;menu&#39;</span><span class="p">]</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="n">voice_menu</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="n">sorted_choices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">voice_choices</span><span class="p">)</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="k">for</span> <span class="n">voice</span> <span class="ow">in</span> <span class="n">sorted_choices</span><span class="p">:</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="n">voice_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>                <span class="n">label</span><span class="o">=</span><span class="n">voice</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="k">lambda</span> <span class="n">v</span><span class="o">=</span><span class="n">voice</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">voice_var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">voice_var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">sorted_choices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="k">def</span> <span class="nf">animate_lips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">viseme</span><span class="p">,</span> <span class="n">viseme_iter</span><span class="p">):</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">        Animates the face that lip-syncs along with the synthesized speech. This</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        uses the list of visemes and their associated timings that is returned from</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        Amazon Polly. The image associated with a viseme is displayed and the next</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">        viseme is scheduled to display at the time indicated in the list of visemes.</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        :param start_time: The time the animation is started. This is used to</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">                           calculate the time to wait until the next viseme image</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">                           is displayed.</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">        :param viseme: The current viseme to display.</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">        :param viseme_iter: An iterator that yields visemes from the list returned</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">                            from Amazon Polly.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="n">mouth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lips</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">viseme</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lips</span><span class="p">[</span><span class="s1">&#39;sil&#39;</span><span class="p">])</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">face_canvas</span><span class="o">.</span><span class="n">create_image</span><span class="p">(</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>                <span class="mi">100</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">mouth</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">])</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>            <span class="n">next_viseme</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">viseme_iter</span><span class="p">)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>            <span class="n">next_time</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">+</span> <span class="n">next_viseme</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="n">cur_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span> <span class="o">//</span> <span class="mi">1000000</span>  <span class="c1"># milliseconds</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="n">wait_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">next_time</span> <span class="o">-</span> <span class="n">cur_time</span><span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Vis: </span><span class="si">%s</span><span class="s2">, cur_time </span><span class="si">%s</span><span class="s2">, wait_time </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mouth</span><span class="p">,</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                        <span class="n">cur_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">wait_time</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">after</span><span class="p">(</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>                <span class="n">wait_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">animate_lips</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">next_viseme</span><span class="p">,</span> <span class="n">viseme_iter</span><span class="p">)</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>            <span class="k">pass</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="k">def</span> <span class="nf">long_text_wait_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_type</span><span class="p">,</span> <span class="n">task_status</span><span class="p">):</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">        A callback function that displays status while waiting for an asynchronous</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">        long text speech synthesis task to complete.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">        :param task_type: The type of synthesis task (either &#39;speech&#39; or &#39;viseme&#39;).</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        :param task_status: The status of the task.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">loading_text</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">columnspan</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tkinter</span><span class="o">.</span><span class="n">NSEW</span><span class="p">)</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">loading_text</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>            <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Waiting for </span><span class="si">{</span><span class="n">task_type</span><span class="si">}</span><span class="s2">. Current status: </span><span class="si">{</span><span class="n">task_status</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="k">if</span> <span class="n">task_status</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="s1">&#39;failed&#39;</span><span class="p">):</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">loading_text</span><span class="o">.</span><span class="n">grid_forget</span><span class="p">()</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="k">def</span> <span class="nf">say_it</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        Gets synthesized speech and visemes from Amazon Polly, stores the audio in</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        a temporary file, and plays the sound and lip-sync animation.</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">        When the text is too long for synchronous synthesis, this function displays a</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">        dialog that asks the user for an Amazon Simple Storage Service (Amazon S3)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">        bucket to use for output storage, starts an asynchronous synthesis task, and</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        waits for the task to complete.</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="n">audio_stream</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="n">visemes</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="n">audio_stream</span><span class="p">,</span> <span class="n">visemes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polly_wrapper</span><span class="o">.</span><span class="n">synthesize</span><span class="p">(</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sayit_txt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">END</span><span class="p">),</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">engine_var</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">voice_choices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">voice_var</span><span class="o">.</span><span class="n">get</span><span class="p">()],</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>                <span class="s1">&#39;mp3&#39;</span><span class="p">,</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">language_choices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">language_var</span><span class="o">.</span><span class="n">get</span><span class="p">()],</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>                <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="k">if</span> <span class="n">error</span><span class="o">.</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;Error&#39;</span><span class="p">][</span><span class="s1">&#39;Code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;TextLengthExceededException&#39;</span><span class="p">:</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>                <span class="n">bucket_name</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">simpledialog</span><span class="o">.</span><span class="n">askstring</span><span class="p">(</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>                    <span class="s2">&quot;Text too long&quot;</span><span class="p">,</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>                    <span class="s2">&quot;The text is too long for synchronous synthesis. To start an</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>                    <span class="s2">&quot;asynchronous job, enter the name of an existing Amazon S3</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>                    <span class="s2">&quot;bucket to use for speech synthesis output and click OK.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>                    <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>                <span class="k">if</span> <span class="n">bucket_name</span><span class="p">:</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>                    <span class="n">audio_stream</span><span class="p">,</span> <span class="n">visemes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polly_wrapper</span><span class="o">.</span><span class="n">do_synthesis_task</span><span class="p">(</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">sayit_txt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">END</span><span class="p">),</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">engine_var</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">voice_choices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">voice_var</span><span class="o">.</span><span class="n">get</span><span class="p">()],</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>                        <span class="s1">&#39;mp3&#39;</span><span class="p">,</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                        <span class="n">bucket_name</span><span class="p">,</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">language_choices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">language_var</span><span class="o">.</span><span class="n">get</span><span class="p">()],</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>                        <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">long_text_wait_callback</span><span class="p">)</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Visemes: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">visemes</span><span class="p">))</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="k">if</span> <span class="n">audio_stream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>            <span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tempdir</span><span class="p">:</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>                <span class="n">speech_file_name</span> <span class="o">=</span> <span class="n">tempdir</span> <span class="o">+</span> <span class="s1">&#39;/speech.mp3&#39;</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">speech_file_name</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">speech_file</span><span class="p">:</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>                    <span class="n">speech_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">audio_stream</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>                <span class="n">silence</span> <span class="o">=</span> <span class="s1">&#39;.media/silence.mp3&#39;</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s1">&#39;.media&#39;</span><span class="p">):</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                    <span class="n">silence</span> <span class="o">=</span> <span class="n">GITHUB_URL</span> <span class="o">+</span> <span class="n">silence</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                <span class="c1"># Play a short silent audio file to ensure playsound is loaded and</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>                <span class="c1"># ready. Without this, the audio tends to lag behind viseme playback.</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>                <span class="c1"># playsound(silence)</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>                <span class="n">playsound</span><span class="p">(</span><span class="n">speech_file_name</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>                <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span> <span class="o">//</span> <span class="mi">1000000</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">after</span><span class="p">(</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>                    <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">animate_lips</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;sil&#39;</span><span class="p">},</span> <span class="nb">iter</span><span class="p">(</span><span class="n">visemes</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">polly_wrapper</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initializes the main Tkinter window and adds all of the widgets needed for
the application.</p>
<p>:param polly_wrapper: An object that can call Amazon Polly API functions.</p>

      <details class="quote">
        <summary>Source code in <code>backend/app/utils/tts/backends/resources/aws_example_code/polly_lipsync.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polly_wrapper</span><span class="p">):</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    Initializes the main Tkinter window and adds all of the widgets needed for</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    the application.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    :param polly_wrapper: An object that can call Amazon Polly API functions.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">polly_wrapper</span> <span class="o">=</span> <span class="n">polly_wrapper</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Amazon Polly Lip Sync&quot;</span><span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">resizable</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">load_lips</span><span class="p">()</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="n">choices_frame</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sayit_label</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">wraplength</span><span class="o">=</span><span class="mi">410</span><span class="p">,</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Write some text in the box below, then click &#39;Say it!&#39; &quot;</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>             <span class="s2">&quot;to hear and see your text.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sayit_txt</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">engine_label</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">choices_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Engine:&#39;</span><span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">engine_var</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">StringVar</span><span class="p">(</span><span class="n">choices_frame</span><span class="p">,</span> <span class="s1">&#39;neural&#39;</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">engine_options</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">OptionMenu</span><span class="p">(</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">choices_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine_var</span><span class="p">,</span> <span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="n">polly_wrapper</span><span class="o">.</span><span class="n">get_voice_engines</span><span class="p">()),</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">change_engine</span><span class="p">)</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">language_label</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">choices_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Language:&#39;</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">language_var</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">StringVar</span><span class="p">(</span><span class="n">choices_frame</span><span class="p">,</span> <span class="s1">&#39;US English&#39;</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">language_choices</span> <span class="o">=</span> <span class="n">polly_wrapper</span><span class="o">.</span><span class="n">get_languages</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine_var</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">language_options</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">OptionMenu</span><span class="p">(</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="n">choices_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_var</span><span class="p">,</span> <span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">language_choices</span><span class="p">),</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">change_language</span><span class="p">)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">voice_label</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">choices_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Voice:&#39;</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">voice_var</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">StringVar</span><span class="p">(</span><span class="n">choices_frame</span><span class="p">,</span> <span class="s1">&#39;Joanna&#39;</span><span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">voice_choices</span> <span class="o">=</span> <span class="n">polly_wrapper</span><span class="o">.</span><span class="n">get_voices</span><span class="p">(</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">engine_var</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_choices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">language_var</span><span class="o">.</span><span class="n">get</span><span class="p">()])</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">voice_options</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">OptionMenu</span><span class="p">(</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">choices_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">voice_var</span><span class="p">,</span> <span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">voice_choices</span><span class="p">))</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">face_canvas</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">choices_frame</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sayit_button</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Say it!&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">say_it</span><span class="p">)</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">loading_text</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s2">&quot;635x320&quot;</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sayit_label</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sayit_txt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sayit_txt</span><span class="o">.</span><span class="n">focus_set</span><span class="p">()</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sayit_button</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">columnspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sayit_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">85</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="n">choices_frame</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tkinter</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">engine_label</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tkinter</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">engine_options</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tkinter</span><span class="o">.</span><span class="n">NW</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">engine_options</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">language_label</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tkinter</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">language_options</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tkinter</span><span class="o">.</span><span class="n">NW</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">language_options</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">voice_label</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tkinter</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">voice_options</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tkinter</span><span class="o">.</span><span class="n">NW</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">voice_options</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">face_canvas</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">columnspan</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">face_canvas</span><span class="o">.</span><span class="n">create_image</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lips</span><span class="p">[</span><span class="s1">&#39;sil&#39;</span><span class="p">][</span><span class="s1">&#39;image&#39;</span><span class="p">])</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.animate_lips" class="doc doc-heading">
<code class="highlight language-python"><span class="n">animate_lips</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">viseme</span><span class="p">,</span> <span class="n">viseme_iter</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Animates the face that lip-syncs along with the synthesized speech. This
uses the list of visemes and their associated timings that is returned from
Amazon Polly. The image associated with a viseme is displayed and the next
viseme is scheduled to display at the time indicated in the list of visemes.</p>
<p>:param start_time: The time the animation is started. This is used to
                   calculate the time to wait until the next viseme image
                   is displayed.
:param viseme: The current viseme to display.
:param viseme_iter: An iterator that yields visemes from the list returned
                    from Amazon Polly.</p>

      <details class="quote">
        <summary>Source code in <code>backend/app/utils/tts/backends/resources/aws_example_code/polly_lipsync.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="k">def</span> <span class="nf">animate_lips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">viseme</span><span class="p">,</span> <span class="n">viseme_iter</span><span class="p">):</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    Animates the face that lip-syncs along with the synthesized speech. This</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    uses the list of visemes and their associated timings that is returned from</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    Amazon Polly. The image associated with a viseme is displayed and the next</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    viseme is scheduled to display at the time indicated in the list of visemes.</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    :param start_time: The time the animation is started. This is used to</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">                       calculate the time to wait until the next viseme image</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">                       is displayed.</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">    :param viseme: The current viseme to display.</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    :param viseme_iter: An iterator that yields visemes from the list returned</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">                        from Amazon Polly.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="n">mouth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lips</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">viseme</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lips</span><span class="p">[</span><span class="s1">&#39;sil&#39;</span><span class="p">])</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">face_canvas</span><span class="o">.</span><span class="n">create_image</span><span class="p">(</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="mi">100</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">mouth</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">])</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="n">next_viseme</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">viseme_iter</span><span class="p">)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="n">next_time</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">+</span> <span class="n">next_viseme</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="n">cur_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span> <span class="o">//</span> <span class="mi">1000000</span>  <span class="c1"># milliseconds</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="n">wait_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">next_time</span> <span class="o">-</span> <span class="n">cur_time</span><span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Vis: </span><span class="si">%s</span><span class="s2">, cur_time </span><span class="si">%s</span><span class="s2">, wait_time </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mouth</span><span class="p">,</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                    <span class="n">cur_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">wait_time</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">after</span><span class="p">(</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span class="n">wait_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">animate_lips</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">next_viseme</span><span class="p">,</span> <span class="n">viseme_iter</span><span class="p">)</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.change_engine" class="doc doc-heading">
<code class="highlight language-python"><span class="n">change_engine</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Handles the event that is fired when the selected engine type is changed in
the UI. Updates the lists of available languages and voices that are supported
for the selected engine type.</p>
<p>:param engine: The newly selected engine type.</p>

      <details class="quote">
        <summary>Source code in <code>backend/app/utils/tts/backends/resources/aws_example_code/polly_lipsync.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="k">def</span> <span class="nf">change_engine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">engine</span><span class="p">):</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    Handles the event that is fired when the selected engine type is changed in</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    the UI. Updates the lists of available languages and voices that are supported</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">    for the selected engine type.</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    :param engine: The newly selected engine type.</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">language_choices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polly_wrapper</span><span class="o">.</span><span class="n">get_languages</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="n">lang_menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_options</span><span class="p">[</span><span class="s1">&#39;menu&#39;</span><span class="p">]</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="n">lang_menu</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="n">sorted_choices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">language_choices</span><span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">sorted_choices</span><span class="p">:</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="n">lang_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>            <span class="n">label</span><span class="o">=</span><span class="n">lang</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="k">lambda</span> <span class="n">l</span><span class="o">=</span><span class="n">lang</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_language</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">change_language</span><span class="p">(</span><span class="n">sorted_choices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.change_language" class="doc doc-heading">
<code class="highlight language-python"><span class="n">change_language</span><span class="p">(</span><span class="n">language</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Handles the event that is fired when the selected language is changed in the
UI. Updates the list of available voices that are available for the selected
language and engine type.</p>
<p>:param language: The newly selected language.</p>

      <details class="quote">
        <summary>Source code in <code>backend/app/utils/tts/backends/resources/aws_example_code/polly_lipsync.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="k">def</span> <span class="nf">change_language</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">language</span><span class="p">):</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">    Handles the event that is fired when the selected language is changed in the</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">    UI. Updates the list of available voices that are available for the selected</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">    language and engine type.</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">    :param language: The newly selected language.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">language_var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">language</span><span class="p">)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">voice_choices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polly_wrapper</span><span class="o">.</span><span class="n">get_voices</span><span class="p">(</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">engine_var</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_choices</span><span class="p">[</span><span class="n">language</span><span class="p">])</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="n">voice_menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">voice_options</span><span class="p">[</span><span class="s1">&#39;menu&#39;</span><span class="p">]</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>    <span class="n">voice_menu</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="n">sorted_choices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">voice_choices</span><span class="p">)</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="k">for</span> <span class="n">voice</span> <span class="ow">in</span> <span class="n">sorted_choices</span><span class="p">:</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="n">voice_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>            <span class="n">label</span><span class="o">=</span><span class="n">voice</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="k">lambda</span> <span class="n">v</span><span class="o">=</span><span class="n">voice</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">voice_var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">voice_var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">sorted_choices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.load_lips" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_lips</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Loads lip-sync images either from a local '.media' folder or from GitHub
and saves image data in a dictionary of visemes.</p>

      <details class="quote">
        <summary>Source code in <code>backend/app/utils/tts/backends/resources/aws_example_code/polly_lipsync.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="k">def</span> <span class="nf">load_lips</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    Loads lip-sync images either from a local &#39;.media&#39; folder or from GitHub</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    and saves image data in a dictionary of visemes.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s1">&#39;.media&#39;</span><span class="p">):</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Found .media folder. Loading images from the local folder.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="k">for</span> <span class="n">viseme</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lips</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lips</span><span class="p">[</span><span class="n">viseme</span><span class="p">][</span><span class="s1">&#39;image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lips</span><span class="p">[</span><span class="n">viseme</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No local .media folder. Trying to load images from GitHub.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="k">for</span> <span class="n">viseme</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lips</span><span class="p">:</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="n">url</span> <span class="o">=</span> <span class="n">GITHUB_URL</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lips</span><span class="p">[</span><span class="n">viseme</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span> <span class="k">else</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t load image from </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lips</span><span class="p">[</span><span class="n">viseme</span><span class="p">][</span><span class="s1">&#39;image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">img</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.long_text_wait_callback" class="doc doc-heading">
<code class="highlight language-python"><span class="n">long_text_wait_callback</span><span class="p">(</span><span class="n">task_type</span><span class="p">,</span> <span class="n">task_status</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>A callback function that displays status while waiting for an asynchronous
long text speech synthesis task to complete.</p>
<p>:param task_type: The type of synthesis task (either 'speech' or 'viseme').
:param task_status: The status of the task.</p>

      <details class="quote">
        <summary>Source code in <code>backend/app/utils/tts/backends/resources/aws_example_code/polly_lipsync.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="k">def</span> <span class="nf">long_text_wait_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_type</span><span class="p">,</span> <span class="n">task_status</span><span class="p">):</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">    A callback function that displays status while waiting for an asynchronous</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">    long text speech synthesis task to complete.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">    :param task_type: The type of synthesis task (either &#39;speech&#39; or &#39;viseme&#39;).</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    :param task_status: The status of the task.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">loading_text</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">columnspan</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="n">tkinter</span><span class="o">.</span><span class="n">NSEW</span><span class="p">)</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">loading_text</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Waiting for </span><span class="si">{</span><span class="n">task_type</span><span class="si">}</span><span class="s2">. Current status: </span><span class="si">{</span><span class="n">task_status</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>    <span class="k">if</span> <span class="n">task_status</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="s1">&#39;failed&#39;</span><span class="p">):</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">loading_text</span><span class="o">.</span><span class="n">grid_forget</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="backend.app.utils.tts.backends.resources.aws_example_code.polly_lipsync.PollyMouth.say_it" class="doc doc-heading">
<code class="highlight language-python"><span class="n">say_it</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Gets synthesized speech and visemes from Amazon Polly, stores the audio in
a temporary file, and plays the sound and lip-sync animation.</p>
<p>When the text is too long for synchronous synthesis, this function displays a
dialog that asks the user for an Amazon Simple Storage Service (Amazon S3)
bucket to use for output storage, starts an asynchronous synthesis task, and
waits for the task to complete.</p>

      <details class="quote">
        <summary>Source code in <code>backend/app/utils/tts/backends/resources/aws_example_code/polly_lipsync.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="k">def</span> <span class="nf">say_it</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">    Gets synthesized speech and visemes from Amazon Polly, stores the audio in</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    a temporary file, and plays the sound and lip-sync animation.</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">    When the text is too long for synchronous synthesis, this function displays a</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    dialog that asks the user for an Amazon Simple Storage Service (Amazon S3)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">    bucket to use for output storage, starts an asynchronous synthesis task, and</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">    waits for the task to complete.</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="n">audio_stream</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="n">visemes</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="n">audio_stream</span><span class="p">,</span> <span class="n">visemes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polly_wrapper</span><span class="o">.</span><span class="n">synthesize</span><span class="p">(</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sayit_txt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">END</span><span class="p">),</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">engine_var</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">voice_choices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">voice_var</span><span class="o">.</span><span class="n">get</span><span class="p">()],</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="s1">&#39;mp3&#39;</span><span class="p">,</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">language_choices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">language_var</span><span class="o">.</span><span class="n">get</span><span class="p">()],</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="k">if</span> <span class="n">error</span><span class="o">.</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;Error&#39;</span><span class="p">][</span><span class="s1">&#39;Code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;TextLengthExceededException&#39;</span><span class="p">:</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="n">bucket_name</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">simpledialog</span><span class="o">.</span><span class="n">askstring</span><span class="p">(</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>                <span class="s2">&quot;Text too long&quot;</span><span class="p">,</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>                <span class="s2">&quot;The text is too long for synchronous synthesis. To start an</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>                <span class="s2">&quot;asynchronous job, enter the name of an existing Amazon S3</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>                <span class="s2">&quot;bucket to use for speech synthesis output and click OK.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>                <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="k">if</span> <span class="n">bucket_name</span><span class="p">:</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>                <span class="n">audio_stream</span><span class="p">,</span> <span class="n">visemes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polly_wrapper</span><span class="o">.</span><span class="n">do_synthesis_task</span><span class="p">(</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">sayit_txt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">END</span><span class="p">),</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">engine_var</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">voice_choices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">voice_var</span><span class="o">.</span><span class="n">get</span><span class="p">()],</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>                    <span class="s1">&#39;mp3&#39;</span><span class="p">,</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                    <span class="n">bucket_name</span><span class="p">,</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">language_choices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">language_var</span><span class="o">.</span><span class="n">get</span><span class="p">()],</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>                    <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">long_text_wait_callback</span><span class="p">)</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Visemes: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">visemes</span><span class="p">))</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>    <span class="k">if</span> <span class="n">audio_stream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>        <span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tempdir</span><span class="p">:</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>            <span class="n">speech_file_name</span> <span class="o">=</span> <span class="n">tempdir</span> <span class="o">+</span> <span class="s1">&#39;/speech.mp3&#39;</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">speech_file_name</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">speech_file</span><span class="p">:</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>                <span class="n">speech_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">audio_stream</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="n">silence</span> <span class="o">=</span> <span class="s1">&#39;.media/silence.mp3&#39;</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s1">&#39;.media&#39;</span><span class="p">):</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                <span class="n">silence</span> <span class="o">=</span> <span class="n">GITHUB_URL</span> <span class="o">+</span> <span class="n">silence</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>            <span class="c1"># Play a short silent audio file to ensure playsound is loaded and</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="c1"># ready. Without this, the audio tends to lag behind viseme playback.</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="c1"># playsound(silence)</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="n">playsound</span><span class="p">(</span><span class="n">speech_file_name</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span> <span class="o">//</span> <span class="mi">1000000</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">after</span><span class="p">(</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>                <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">animate_lips</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;sil&#39;</span><span class="p">},</span> <span class="nb">iter</span><span class="p">(</span><span class="n">visemes</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.sections", "navigation.tracking", "navigation.expand"], "search": "../../../../../../../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../../../assets/javascripts/bundle.a00a7c5e.min.js"></script>
      
    
  </body>
</html>